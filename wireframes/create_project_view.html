<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Nuevo Proyecto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }

        /* Estilos base para campos de formulario */
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            border-color: #555;
            outline: none;
            box-shadow: 0 0 0 2px rgba(85, 85, 85, 0.2);
        }
        /* Estilo para el botón principal (simulado) */
        .btn-primary {
            padding: 10px 20px;
            background-color: #333; /* Gris oscuro */
            color: white;
            font-weight: 600;
            border-radius: 8px;
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            background-color: #1a1a1a;
            transform: translateY(-1px);
        }

        /* Estilo para los tags de colaborador (simulado) */
        .collaborator-tag {
            display: inline-flex;
            align-items: center;
            background-color: #e5e7eb; /* gray-200 */
            color: #374151; /* gray-700 */
            padding: 6px 10px;
            border-radius: 9999px; /* full rounded */
            font-size: 0.875rem;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .collaborator-tag button {
            margin-left: 8px;
            color: #9ca3af; /* gray-400 */
            transition: color 0.2s;
        }
        .collaborator-tag button:hover {
            color: #4b5563; /* gray-600 */
        }
    </style>
</head>
<body class="p-4 sm:p-8 bg-gray-100 min-h-screen">
    <div class="max-w-3xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-200">
        
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Crear Nuevo Proyecto de Formalización</h1>
        
        <form id="project-form" onsubmit="handleFormSubmit(event)">
            
            <!-- 1. Nombre del Proyecto -->
            <div class="mb-6">
                <label for="projectName" class="block text-sm font-medium text-gray-700 mb-2">
                    Nombre del Proyecto <span class="text-red-500">*</span>
                </label>
                <input type="text" id="projectName" name="projectName" required class="form-input" placeholder="Ej: Fundamentos de la Teoría de Conjuntos">
            </div>

            <!-- 2. Visibilidad del Proyecto -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Grado de Visibilidad
                </label>
                <div class="flex items-center space-x-6">
                    <!-- Opción Público -->
                    <label class="inline-flex items-center">
                        <input type="radio" name="visibility" value="public" checked onchange="toggleCollaboratorInput(this.value)" class="h-4 w-4 text-gray-600 border-gray-300 focus:ring-gray-500">
                        <span class="ml-2 text-gray-700">Público (Visible para todos) </span>
                    </label>
                    <!-- Opción Privado -->
                    <label class="inline-flex items-center">
                        <input type="radio" name="visibility" value="private" onchange="toggleCollaboratorInput(this.value)" class="h-4 w-4 text-gray-600 border-gray-300 focus:ring-gray-500">
                        <span class="ml-2 text-gray-700">Privado (Solo colaboradores) </span>
                    </label>
                </div>
            </div>

            <!-- 3. Importar Premisas (Opcional) -->
            <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                <label for="importProject" class="flex items-center text-sm font-medium text-gray-700 cursor-pointer">
                    <input type="checkbox" id="importToggle" onchange="toggleImportSelection(this.checked)" class="h-4 w-4 text-gray-600 border-gray-300 rounded focus:ring-gray-500">
                    <span class="ml-3">Importar premisas de un proyecto existente (Opcional)</span>
                </label>
                <div id="importSelection" class="mt-3 hidden">
                    <select id="importProject" name="importProject" class="form-input bg-white">
                        <option value="" disabled selected>Selecciona un proyecto...</option>
                        <option value="project-a">Lean 4 Core Library</option>
                        <option value="project-b">Matemática Elemental Verificada</option>
                        <option value="project-c">Teoría de Categorías</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Se copiarán todos los teoremas y definiciones del proyecto seleccionado como base.</p>
                </div>
            </div>

            <!-- 4. Colaboradores (Solo si es Privado) -->
            <div id="collaborator-section" class="mb-8 hidden p-4 border border-red-200 bg-red-50 rounded-lg">
                <label for="collaboratorInput" class="block text-sm font-medium text-gray-800 mb-3">
                    Añadir Colaboradores (Nombres de Usuario)
                </label>
                
                <!-- Contenedor de Tags -->
                <div id="collaborator-tags" class="min-h-[30px] flex flex-wrap items-center mb-3">
                    <!-- Tags se insertarán aquí -->
                </div>

                <!-- Input para añadir -->
                <div class="flex space-x-2">
                    <input type="text" id="collaboratorInput" placeholder="Escribe el nombre de usuario y presiona Enter" class="form-input flex-grow">
                    <button type="button" onclick="addCollaborator()" class="btn-primary flex-shrink-0 bg-gray-500 hover:bg-gray-700 text-sm">
                        Añadir
                    </button>
                </div>
            </div>

            <!-- Botón de Creación -->
            <div class="pt-4 border-t border-gray-200 mt-4">
                <button type="submit" class="btn-primary w-full sm:w-auto">
                    Crear Proyecto
                </button>
            </div>
            
        </form>
        
        <!-- Contenedor para mensajes de estado/error -->
        <div id="message-box" class="mt-6 p-4 rounded-lg text-sm hidden"></div>
        
    </div>

    <script>
        const collaboratorUsernames = ["usuario_ejemplo1", "usuario_ejemplo2"];

        /**
         * Maneja el cambio de visibilidad para mostrar/ocultar la sección de colaboradores.
         * @param {string} visibility - 'public' o 'private'.
         */
        function toggleCollaboratorInput(visibility) {
            const collaboratorSection = document.getElementById('collaborator-section');
            if (visibility === 'private') {
                collaboratorSection.classList.remove('hidden');
            } else {
                collaboratorSection.classList.add('hidden');
            }
        }
        
        /**
         * Maneja el cambio del checkbox para mostrar/ocultar el selector de importación.
         * @param {boolean} checked - Estado del checkbox.
         */
        function toggleImportSelection(checked) {
            const importSelectionDiv = document.getElementById('importSelection');
            if (checked) {
                importSelectionDiv.classList.remove('hidden');
            } else {
                importSelectionDiv.classList.add('hidden');
            }
        }

        /**
         * Añade un colaborador a la lista visual.
         */
        function addCollaborator() {
            const input = document.getElementById('collaboratorInput');
            const username = input.value.trim();

            if (username && !collaboratorUsernames.includes(username)) {
                collaboratorUsernames.push(username);
                input.value = '';
                renderCollaboratorTags();
            } else if (collaboratorUsernames.includes(username)) {
                showMessage('El usuario ya ha sido añadido.', 'yellow');
            } else {
                showMessage('Por favor, ingrese un nombre de usuario válido.', 'yellow');
            }
        }
        
        /**
         * Remueve un colaborador de la lista visual.
         * @param {string} usernameToRemove - Nombre de usuario a remover.
         */
        function removeCollaborator(usernameToRemove) {
            const index = collaboratorUsernames.indexOf(usernameToRemove);
            if (index > -1) {
                collaboratorUsernames.splice(index, 1);
                renderCollaboratorTags();
            }
        }

        /**
         * Renderiza la lista de colaboradores como tags.
         */
        function renderCollaboratorTags() {
            const container = document.getElementById('collaborator-tags');
            container.innerHTML = '';
            
            collaboratorUsernames.forEach(username => {
                const tag = document.createElement('div');
                tag.className = 'collaborator-tag';
                tag.innerHTML = `
                    <span>${username}</span>
                    <button type="button" onclick="removeCollaborator('${username}')">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                `;
                container.appendChild(tag);
            });
        }
        
        /**
         * Muestra un mensaje de estado o error.
         * @param {string} message - Mensaje a mostrar.
         * @param {string} type - Tipo de mensaje ('green', 'red', 'yellow').
         */
        function showMessage(message, type) {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
            
            if (type === 'green') {
                box.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'red') {
                box.classList.add('bg-red-100', 'text-red-800');
            } else { // yellow
                box.classList.add('bg-yellow-100', 'text-yellow-800');
            }
            
            // Ocultar automáticamente después de 3 segundos
            setTimeout(() => {
                box.classList.add('hidden');
            }, 3000);
        }

        /**
         * Maneja el envío del formulario (simulado).
         */
        function handleFormSubmit(event) {
            event.preventDefault();
            
            const projectName = document.getElementById('projectName').value.trim();
            const visibility = document.querySelector('input[name="visibility"]:checked').value;
            const importChecked = document.getElementById('importToggle').checked;
            const importProject = importChecked ? document.getElementById('importProject').value : null;

            if (!projectName) {
                showMessage('El nombre del proyecto es obligatorio.', 'red');
                return;
            }

            const projectData = {
                name: projectName,
                visibility: visibility,
                import: importChecked,
                importSource: importProject,
                collaborators: visibility === 'private' ? collaboratorUsernames : []
            };
            
            console.log("Datos del Proyecto Creado:", projectData);
            showMessage(`¡Proyecto '${projectName}' creado exitosamente! Visibilidad: ${visibility.toUpperCase()}.`, 'green');
            
            // Aquí iría la lógica real de envío a Firestore o un API.
            // Para el ejemplo, simplemente reseteamos el nombre y la lista de colaboradores
            document.getElementById('projectName').value = '';
            collaboratorUsernames.length = 0;
            renderCollaboratorTags();
            document.querySelector('input[name="visibility"][value="public"]').checked = true;
            toggleCollaboratorInput('public');
        }

        // Inicializar la vista de colaboradores
        document.addEventListener('DOMContentLoaded', () => {
            renderCollaboratorTags();
            const inputElement = document.getElementById('collaboratorInput');
            
            // Permitir añadir colaboradores con la tecla Enter
            inputElement.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    addCollaborator();
                }
            });
        });
    </script>
</body>
</html>